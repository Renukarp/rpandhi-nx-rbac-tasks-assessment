<div class="space-y-5">
  <!-- Title row -->
  <div
    class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"
  >
    <div>
      <h1 class="text-2xl font-semibold tracking-tight text-gray-900">Tasks</h1>
      <p class="text-sm text-gray-600">
        Viewer: read-only · Admin: create/edit · Owner: create/edit/delete +
        audit log
      </p>
    </div>

    <button
      *ngIf="canEdit()"
      (click)="openCreate()"
      class="w-full rounded-2xl bg-gradient-to-r from-sky-500 via-indigo-600 to-fuchsia-600 px-4 py-2.5 text-sm font-semibold text-white shadow-lg shadow-indigo-600/20 hover:opacity-95 sm:w-auto"
    >
      + New Task
    </button>
  </div>

  <!-- Error -->
  <div
    *ngIf="error()"
    class="rounded-2xl border border-red-200 bg-red-50 px-4 py-3 text-sm font-medium text-red-700"
  >
    {{ error() }}
  </div>

  <!-- Filters -->
  <div class="rounded-3xl border bg-white/80 p-4 shadow-sm backdrop-blur">
    <div class="grid grid-cols-1 gap-3 sm:grid-cols-4">
      <input
        class="w-full rounded-2xl border px-4 py-2.5 text-sm outline-none transition focus:border-indigo-600 focus:ring-4 focus:ring-indigo-600/10"
        placeholder="Search tasks..."
        [ngModel]="q()"
        (ngModelChange)="q.set($event)"
      />

      <select
        class="w-full rounded-2xl border px-4 py-2.5 text-sm outline-none transition focus:border-indigo-600 focus:ring-4 focus:ring-indigo-600/10"
        [ngModel]="categoryFilter()"
        (ngModelChange)="categoryFilter.set($event)"
      >
        <option value="All">All Categories</option>
        <option value="Work">Work</option>
        <option value="Personal">Personal</option>
      </select>

      <select
        class="w-full rounded-2xl border px-4 py-2.5 text-sm outline-none transition focus:border-indigo-600 focus:ring-4 focus:ring-indigo-600/10"
        [ngModel]="statusFilter()"
        (ngModelChange)="statusFilter.set($event)"
      >
        <option value="All">All Status</option>
        <option value="Todo">Todo</option>
        <option value="InProgress">In Progress</option>
        <option value="Done">Done</option>
      </select>

      <div class="flex gap-2">
        <button
          (click)="toggleSort('createdAt')"
          class="flex-1 rounded-2xl border bg-white px-3 py-2.5 text-sm font-semibold text-gray-800 hover:bg-indigo-50"
        >
          Sort: Created
        </button>
        <button
          (click)="toggleSort('title')"
          class="flex-1 rounded-2xl border bg-white px-3 py-2.5 text-sm font-semibold text-gray-800 hover:bg-indigo-50"
        >
          Sort: Title
        </button>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading()" class="text-sm font-medium text-gray-600">
    Loading...
  </div>

  <!-- Empty state -->
  <div
    *ngIf="!loading() && filtered().length === 0"
    class="rounded-3xl border bg-white p-10 text-center shadow-sm"
  >
    <div
      class="mx-auto h-14 w-14 rounded-2xl bg-gradient-to-br from-emerald-500 to-teal-600 shadow-lg shadow-teal-600/20"
    ></div>
    <div class="mt-4 text-lg font-semibold text-gray-900">No tasks found</div>
    <div class="mt-1 text-sm text-gray-600">
      Try changing filters or create a new task.
    </div>

    <button
      *ngIf="canEdit()"
      (click)="openCreate()"
      class="mt-5 inline-flex rounded-2xl bg-gradient-to-r from-sky-500 via-indigo-600 to-fuchsia-600 px-4 py-2.5 text-sm font-semibold text-white shadow-lg shadow-indigo-600/20 hover:opacity-95"
    >
      + New Task
    </button>
  </div>

  <!-- Cards -->
  <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3">
    <div
      *ngFor="let t of filtered()"
      class="group rounded-3xl border bg-white p-5 shadow-sm transition hover:-translate-y-0.5 hover:shadow-md"
    >
      <div class="flex items-start justify-between gap-3">
        <div class="min-w-0">
          <div class="truncate text-base font-semibold text-gray-900">
            {{ t.title }}
          </div>
          <div class="mt-1 text-sm text-gray-600 line-clamp-2">
            {{ t.description || '—' }}
          </div>
        </div>

        <!-- Status badge (colourful) -->
        <span
          class="shrink-0 rounded-full px-3 py-1 text-xs font-semibold"
          [ngClass]="
            t.status === 'Todo'
              ? 'bg-gray-100 text-gray-700'
              : t.status === 'InProgress'
              ? 'bg-yellow-100 text-yellow-800'
              : 'bg-green-100 text-green-800'
          "
        >
          {{ t.status === 'InProgress' ? 'In Progress' : t.status }}
        </span>
      </div>

      <div class="mt-4 flex items-center justify-between text-xs text-gray-600">
        <div class="flex gap-2">
          <span
            class="rounded-full px-2.5 py-1 font-semibold"
            [ngClass]="
              t.category === 'Work'
                ? 'bg-sky-50 text-sky-700'
                : 'bg-fuchsia-50 text-fuchsia-700'
            "
          >
            {{ t.category }}
          </span>
          <span class="rounded-full bg-gray-100 px-2.5 py-1">
            {{ t.createdAt | date : 'MMM d, y' }}
          </span>
        </div>

        <div class="flex gap-2">
          <button
            *ngIf="canEdit()"
            (click)="openEdit(t)"
            class="rounded-xl border bg-white px-3 py-1.5 text-xs font-semibold text-indigo-700 hover:bg-indigo-50"
          >
            Edit
          </button>

          <button
            *ngIf="canDelete()"
            (click)="askDelete(t)"
            class="rounded-xl border border-red-200 bg-red-50 px-3 py-1.5 text-xs font-semibold text-red-700 hover:bg-red-100"
          >
            Delete
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Create/Edit Modal (keep your existing modal markup; only button colors upgraded) -->
  <div
    *ngIf="modalOpen()"
    class="fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4"
  >
    <div class="w-full max-w-lg rounded-3xl bg-white p-6 shadow-xl">
      <div class="flex items-center justify-between">
        <div class="text-lg font-semibold text-gray-900">
          {{ modalMode() === 'create' ? 'Create Task' : 'Edit Task' }}
        </div>
        <button
          (click)="closeModal()"
          class="rounded-xl px-2 py-1 text-sm text-gray-700 hover:bg-gray-100"
        >
          ✕
        </button>
      </div>

      <div class="mt-4 grid grid-cols-1 gap-3">
        <input
          class="w-full rounded-2xl border px-4 py-2.5 text-sm outline-none transition focus:border-indigo-600 focus:ring-4 focus:ring-indigo-600/10"
          placeholder="Title"
          [ngModel]="title()"
          (ngModelChange)="title.set($event)"
        />

        <textarea
          class="w-full rounded-2xl border px-4 py-2.5 text-sm outline-none transition focus:border-indigo-600 focus:ring-4 focus:ring-indigo-600/10"
          placeholder="Description (optional)"
          rows="3"
          [ngModel]="description()"
          (ngModelChange)="description.set($event)"
        ></textarea>

        <div class="grid grid-cols-2 gap-3">
          <select
            class="w-full rounded-2xl border px-4 py-2.5 text-sm outline-none transition focus:border-indigo-600 focus:ring-4 focus:ring-indigo-600/10"
            [ngModel]="category()"
            (ngModelChange)="category.set($event)"
          >
            <option value="Work">Work</option>
            <option value="Personal">Personal</option>
          </select>

          <select
            class="w-full rounded-2xl border px-4 py-2.5 text-sm outline-none transition focus:border-indigo-600 focus:ring-4 focus:ring-indigo-600/10"
            [ngModel]="status()"
            (ngModelChange)="status.set($event)"
          >
            <option value="Todo">Todo</option>
            <option value="InProgress">In Progress</option>
            <option value="Done">Done</option>
          </select>
        </div>

        <div class="mt-2 flex gap-2">
          <button
            (click)="closeModal()"
            class="flex-1 rounded-2xl border px-4 py-2.5 text-sm font-semibold hover:bg-gray-50"
          >
            Cancel
          </button>
          <button
            (click)="save()"
            class="flex-1 rounded-2xl bg-gradient-to-r from-sky-500 via-indigo-600 to-fuchsia-600 px-4 py-2.5 text-sm font-semibold text-white shadow-lg shadow-indigo-600/20 hover:opacity-95"
          >
            Save
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Delete Confirm Modal -->
  <div
    *ngIf="confirmOpen()"
    class="fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4"
  >
    <div class="w-full max-w-md rounded-3xl bg-white p-6 shadow-xl">
      <div class="flex items-center gap-3">
        <div class="h-10 w-10 rounded-2xl bg-red-50"></div>
        <div>
          <h2 class="text-lg font-semibold text-gray-900">Delete Task</h2>
          <p class="text-sm text-gray-600">This action cannot be undone.</p>
        </div>
      </div>

      <p class="mt-4 text-sm text-gray-700">
        Are you sure you want to delete
        <span class="font-semibold">{{ taskToDelete()?.title }}</span
        >?
      </p>

      <div class="mt-6 flex gap-3">
        <button
          (click)="cancelDelete()"
          class="flex-1 rounded-2xl border px-4 py-2.5 text-sm font-semibold hover:bg-gray-50"
        >
          Cancel
        </button>

        <button
          (click)="confirmDelete()"
          class="flex-1 rounded-2xl bg-red-600 px-4 py-2.5 text-sm font-semibold text-white hover:bg-red-700"
        >
          Delete
        </button>
      </div>
    </div>
  </div>
</div>
